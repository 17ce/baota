var bt_tools={table:function(e){function t(e){this.config=e,this.$load()}return t.prototype={style_list:[],event_list:{},checkbox_list:[],batch_active:{},event_rows_model:{},data:[],page:"",column:[],batch_thread:[],random:bt.get_random(5),init:!1,checked:!1,$load:function(){var e=this;this.config.init&&this.config.init(this),$(this.config.el).addClass("bt_table"),this.config.minWidth&&this.style_list.push({className:this.config.el+" table",css:"min-width:"+this.config.minWidth}),this.config.tootls?this.$reader_tootls(this.config.tootls):0===$(e.config.el+".divtable").length&&$(e.config.el).append('<div class="divtable mtb10"></div>'),this.$reader_content(),void 0!==e.config.url?this.$refresh_table_list():void 0!==this.config.data?this.$reader_content(this.config.data):alert("缺少data或url参数")},$refresh_table_list:function(e){var t,a=this;e&&(t=bt.load("正在获取列表数据,请稍后...")),this.$http(function(s,i){e&&t.close(),a.$reader_content(s,i)})},$fixed_table_meter:function(){},$reader_content:function(e,t){var a=this,s="",i="",n=0,c=this.config.column,l={},o=$(a.config.el+" .checkbox_"+a.random);e=e||[],this.data=e,o.length&&(o.removeClass("active selected"),a.checkbox_list=[],a.$set_batch_view());do{var r=e[n],d=0;e.length>0&&(i+="<tr>");for(var h=0;h<c.length;h++){var p=c[h];if($.isEmptyObject(p))d++;else{if(0===n&&!this.init){this.init||this.style_list.push(this.$dynamic_merge_style(p,h-d));var u="sort_"+this.random,f="checkbox_"+this.random,b=p.sortValue||"desc";s+="<th><span "+(p.sort?'class="not-select '+u+(p.sortValue?" sort-active":"")+' cursor-pointer"':"")+' data-index="'+h+'" '+(p.sort?'data-sort="'+b+'"':"")+">"+("checkbox"==p.type?'<label><i class="cust—checkbox cursor-pointer '+f+'" data-checkbox="all"></i><input type="checkbox" class="cust—checkbox-input"></label>':"<span>"+p.title+"</span>")+(p.sort?'<span class="glyphicon glyphicon-triangle-'+("desc"==b?"bottom":"top")+' ml5"></span>':"")+"</span></th>",0===n&&(!l[u]&&p.sort&&(l[u]={event:this.config.sortEvent,eventType:"click",type:"sort"}),l[f]||(l[f]={event:p.checked,eventType:"click",type:"checkbox"}))}if(void 0!==r){var v="event-"+p.fid+"-"+this.random,_="";if(p.template){var m=p.template(r,h),g=$(m);_=g.length>0?g.addClass(v)[0].outerHTML:'<a href="javascript:;" class="btlink '+v+'">'+m+"</a>"}else _=this.$reader_column_type(p,r),l=$.extend(l,_[1]),_=_[0];i+="<td><span "+(p.class?'class="'+p.class+'"':"")+" "+(p.tips?'title="'+p.tips+'"':"")+">"+_+"</span></td>",0===n&&!l[v]&&p.event&&(l[v]={event:p.event,eventType:"click",type:"rows"})}}}e.length>0&&(i+="</tr>"),0==e.length&&(i+='<tr><td colspan="'+c.length+'" style="text-align:center;">'+(this.config.default||"数据为空")+"</td></tr>"),n++}while(n<e.length);this.init||this.$style_bind(this.style_list),this.$event_bind(l),this.init?($(this.config.el+" .divtable tbody").html(i),this.config.page&&t&&$(this.config.el+" .page").replaceWith(this.$reader_page(this.config.page,t))):$(this.config.el+" .divtable").append('<table class="table table-hover"><thead>'+s+"</thead><tbody>"+i+"</tbody></table></div></div>"),this.init=!0,this.config.success&&this.config.success(this)},$modify_row_data:function(e){this.event_rows_model.rows=$.extend(this.event_rows_model.rows,e);var t=this.event_rows_model;void 0!==t.model.template?t.el.replaceWith(t.model.template(t.rows,t.index)):t.el.replaceWith(this.$reader_column_type(t.model,t.rows))},$batch_success_table:function(e){var t=this;bt.open({type:1,title:e.title,area:e.area||["350px","350px"],shadeClose:!1,closeBtn:2,content:e.content||'<div class="batch_title"><span class><span class="batch_icon"></span><span class="batch_text">'+e.title+'操作完成！</span></span></div><div class="fiexd_thead divtable" style="margin: 15px 30px 15px 30px;overflow: auto;height: 200px;"><table class="table table-hover"><thead><tr><th>'+e.th+'</th><th style="text-align:right;width:120px;">操作结果</th></tr></thead><tbody>'+e.html+"</tbody></table></div>",success:function(){t.$fixed_table_thead(".fiexd_thead")}})},$delete_table_row:function(e){this.data.splice(e,1),this.$reader_content(this.data)},$fixed_table_thead:function(e){$(e).scroll(function(){var e=this.scrollTop;this.querySelector("thead").style.transform="translateY("+e+"px)"})},$set_batch_view:function(){var e=$(this.config.el+" .bt_select_value"),t=$(this.config.el+" .bt_table_select_group").next();if(e.length>0)this.checkbox_list.length>0?(e.find("em").html("(已选中"+this.checkbox_list.length+")"),e.parent().removeClass("bt_disabled"),t.removeClass("bt-disabled")):(e.parent().addClass("bt_disabled"),e.find(".bt_select_tips").html("请选择批量操作<em></em>"),t.addClass("bt-disabled"),t.find(".item").removeClass("active"),t.find(".bt_selects li").removeClass("active"),e.next().find("li").removeClass("active"),this.batch_active={});else{for(var a=$(this.config.el+" .set_batch_option"),s=$(this.config.el+' [data-checkbox="all"]'),i=0;i<this.config.tootls.length;i++)this.config.tootls[i].selectList&&a.text(this.config.tootls[i].selectList[0].batch_btn_name);if(s.hasClass("selected")||s.hasClass("active")){a.removeClass("bt-disabled");var n=a.text()+" (选中"+$(this.config.el+" tbody .cust—checkbox.active").length+"个)";a.text(n)}else a.addClass("bt-disabled"),a.find(".item").removeClass("active")}},$reader_column_type:function(e,t){var a=t[e.fid],s={},i="",n=[],c=this;switch(e.type){case"text":n=[a,s];break;case"checkbox":n=['<label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'"></i><input type="checkbox" class="cust—checkbox-input"></label>',s];break;case"link":i="click_"+e.fid+"_"+this.random,!s[i]&&e.event&&(s[i]={event:e.event,type:"rows"}),n=['<a class="btlink '+i+'" href="'+(e.href?a:"javascript:;")+'" '+(e.href?'target="'+(e.target||"_blank")+'"':"")+' title="'+a+'">'+a+"</a>",s];break;case"input":blurName="blur_"+e.fid+"_"+this.random,keyupName="keyup_"+e.fid+"_"+this.random,!s[blurName]&&e.blur&&(s[blurName]={event:e.blur,eventType:"blur",type:"rows"}),!s[keyupName]&&e.keyup&&(s[keyupName]={event:e.keyup,eventType:"keyup",type:"rows"}),n=['<input type="text" title="点击编辑内容，按回车或失去焦点自动保存"  class="table-input '+blurName+" "+keyupName+'" value="'+a+'">',s];break;case"status":var l="";i="click_"+e.fid+"_"+this.random,$.each(e.config.list,function(e,t){t[0]===a&&(l=t)}),!s[i]&&e.event&&(s[i]={event:e.event,type:"rows"}),n=['<a class="btlink '+i+" "+(l[2].indexOf("#")>-1?"":l[2])+'" style="'+(l[2].indexOf("#")>-1?"color:"+l[2]+";":"")+'" href="javascript:;"><span>'+l[1]+"</span>"+(e.config.icon?'<span class="glyphicon '+l[3]+'"></span>':"")+"</a>",s];break;case"switch":break;case"group":var o="";$.each(e.group,function(a,n){if(i="group_"+a+"_"+c.random,n.template){var l=n.template(t,c),r=$(l);r.length>0?o+=r.addClass(i)[0].outerHTML:o+='<a href="javascript:;" class="btlink '+i+'">'+l+"</a>"}else o+='<a href="javascript:;" class="btlink '+i+'" '+(n.hide?'style="display:none;"':"")+">"+n.title+"</a>"+(e.group.length-1!=a?"&nbsp;&nbsp;|&nbsp;&nbsp;":"");!s[i]&&n.event&&(s[i]={event:n.event,type:"rows"})}),n=[o,s];break;default:n=[a,s]}return n},$reader_tootls:function(e){function t(e,t){var a=bt.load("正在执行批量"+e.title+"，请稍后..."),i={},n=s.$get_data_batch_list(e.paramId,t);e.beforeRequest?i[e.paramName]=e.beforeRequest(t):i[e.paramName]=n.join(","),bt_tools.send({url:e.url||s.config.batch.url,data:$.extend(e.param||{},i)},function(i){if(a.close(),!i.status)return!1;if(void 0===e.tips||e.tips){var n="";$.each(i.error,function(e,t){n+="<tr><td>"+e+'</td><td><div style="float:right;" class="size_ellipsis"><span style="color:red">'+t+"</span></div></td></tr>"}),$.each(i.success,function(e,t){n+="<tr><td>"+t+'</td><td><div style="float:right;" class="size_ellipsis"><span style="color:#20a53a">操作成功</span></div></td></tr>'}),s.$batch_success_table({title:"批量"+e.title,th:e.theadName,html:n}),s.$refresh_table_list(!0)}e.success&&e.success(i,t,s)})}function a(e,a,s){e.callback?e.callback({loadT:0,config:{},check_list:a,start_batch:function(t,a){e.load&&(this.loadT=layer.msg("正在执行批量"+e.title+'，<span class="batch_progress">进度:0/'+this.check_list.length+"</span>,请稍后...",{icon:16,skin:"batch_tips",shade:.3,time:0})),this.config={param:t,url:e.url},this.bacth(a)},bacth:function(t,i){var n=this;if("function"==typeof t&&(i=t,t=0),t<this.check_list.length){for(var c in"function"==typeof e.param&&(e.param=e.param(a[t])),e.param){var l=e.param[c];n.config.param[c]=n.check_list[t][l]}e.paramId&&(n.config.param[e.paramId]=n.check_list[t][e.paramId]),this.config.param.bacth&&t==this.check_list.length-1&&delete this.config.param.bacth,bt_tools.send({url:this.config.url,data:this.config.param,bacth:!0},function(e){$.extend(n.check_list[t],{request:{status:"boolean"==typeof e.status&&e.status,msg:e.msg||"请求网络错误"}}),t++,n.bacth(t,i)})}else s&&s(),i(this.check_list),layer.close(this.loadT)}}):e.confirm?t(e,a):e.confirmVerify?bt.show_confirm("批量"+e.title,"批量"+e.title+"，该操作可能会存在风险，是否继续？",t):bt.confirm({title:"批量"+e.title,msg:"批量"+e.title+"，该操作可能会存在风险，是否继续？"},function(){t&&t(e,a)})}for(var s=this,i={},n=0;n<e.length;n++){var c="",l=e[n];switch(l.type){case"btnGroup":$.each(l.list,function(e,t){var a=l.type+"_"+s.random+"_"+e;t.group?(c+='<div class="btn-group" style="vertical-align: top;">                                        <button type="button" class="btn btn-default '+a+' btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span style="margin-right:2px;">分类管理</span><span class="caret" style="position: relative;top: -1px;"></span></button>                                        <ul class="dropdown-menu"></ul>                                    </div>',l.list&&$.each(l.list,function(e,t){'<li><a href="javascript:;" NaN'+t[l.key]+"</a></li>"}),t.init&&setTimeout(function(){t.init(a)},400)):c+='<button type="button" class="btn '+(t.active?"btn-success":"btn-default")+" "+a+' btn-sm mr5">'+t.title+"</button>",i[a]||(i[a]={event:t.event,type:"button"})});break;case"search":this.config.search=l;var o="search_input_"+this.random,r="search_btn_"+this.random;c='<div class="bt_search"><input type="text" class="search_input '+o+'" style="'+(l.width?"width:"+l.width:"")+'" placeholder="'+(l.placeholder||"")+'"/><span class="glyphicon glyphicon-search '+r+'" aria-hidden="true"></span></div>',i[o]||(i[o]={eventType:"keyup",type:"search_input"}),i[r]||(i[r]={type:"search_btn"});break;case"batch":this.config.batch=l;var d=[],h="";$.each(l.selectList,function(e,t){t.group?($.each(t.group,function(e,a){d.push($.extend({},t,a)),h+='<li class="item">'+a.title+"</li>"}),delete t.group):(d.push(t),h+='<li class="item">'+t.title+"</li>")}),$(s.config.el).on("click",".bt_table_select_group .bt_select_value",function(e){var t=$(this).parent(),a=t.find(".bt_selects"),i=t.offset(),n=s.$get_win_area();return t.hasClass("bt_disabled")?(layer.tips(s.config.batch.disabledSelectValue,t,{tips:[1,"red"],time:2e3}),!1):(t.hasClass("active")?t.removeClass("active"):t.addClass("active"),a.height()>n[1]-i.top?a.addClass("top"):a.removeClass("top"),$(document).click(function(){return $(s.config.el).find(".bt_table_select_group").removeClass("active"),$(this).unbind("click"),!1}),!1)}),$(s.config.el).on("click",".bt_table_select_group .item",function(e){var t=$(this).text(),a=$(this).index();$(this).addClass("active").siblings().removeClass("active"),$(s.config.el+" .bt_select_tips").html("批量"+t+"<em>(已选中"+s.checkbox_list.length+")</em>"),s.batch_active=d[a],s.checked||$(".bt_table_select_group").removeClass("active")}),$(s.config.el).on("click",".set_batch_option",function(e){var i=[],n=s.batch_active;if($(this).hasClass("bt-disabled"))return layer.tips(s.config.batch.disabledSelectValue,$(this),{tips:[1,"red"],time:2e3}),!1;for(var c=0;c<s.checkbox_list.length;c++)i.push(s.data[s.checkbox_list[c]]);if("{}"===JSON.stringify(n)){var l=$(s.config.el+" .bt_table_select_group");return layer.tips("请选择需要批量操作的类型",l,{tips:[1,"red"],time:2e3}),l.css("border","1px solid red"),setTimeout(function(){l.removeAttr("style")},2e3),!1}switch(typeof n.confirm){case"function":n.confirm(n,function(e,t){n.param=$.extend(n.param,e),a(n,i,t)});break;case"undefined":a(n,i);break;case"object":var o=n.confirm;bt.open({title:o.title||"批量操作",area:o.area||"350px",btn:o.btn||["确认","取消"],content:o.content,success:function(e,t){o.success(e,t,n)},yes:function(e,a){o.yes(e,a,function(e,a){n.param=$.extend(n.param,e),t(n,i)})}})}}),c='<div class="bt_batch "><label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'" data-checkbox="all"></i><input type="checkbox" lass="cust—checkbox-input" /></label><div class="bt_table_select_group bt_disabled not-select"><span class="bt_select_value"><span class="bt_select_tips">请选择批量操作<em></em></span><span class="glyphicon glyphicon-triangle-bottom ml5"></span></span><ul class="bt_selects ">'+h+'</ul></div><button class="btn btn-success btn-sm set_batch_option bt-disabled" >'+l.buttonValue+"</button></div>";break;case"batch_btn":s.batch=l,$(s.config.el).on("click",".set_batch_option",function(e){var i=[],n={},c=$(this).index()-1;if(s.batch_active=s.batch.selectList[c],n=s.batch_active,$(this).hasClass("bt-disabled"))return layer.tips(s.batch.disabledSelectValue,$(this),{tips:[1,"red"],time:2e3}),!1;for(var l=0;l<s.checkbox_list.length;l++)i.push(s.data[s.checkbox_list[l]]);switch(typeof n.confirm){case"function":n.confirm(n,function(e,t){n.param=$.extend(n.param,e),a(n,i,t)});break;case"undefined":a(n,i);break;case"object":var o=n.confirm;bt.open({title:o.title||"批量操作",area:o.area||"350px",btn:o.btn||["确认","取消"],content:o.content,success:function(e,t){o.success(e,t,n)},yes:function(e,a){o.yes(e,a,function(e,a){n.param=$.extend(n.param,e),t(n,i)})}})}}),c='<div class="bt_batch "><label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'" data-checkbox="all"></i><input type="checkbox" lass="cust—checkbox-input" /></label><button class="btn btn-success btn-sm set_batch_option bt-disabled">批量操作</button></div>';break;case"page":this.config.page=l;var p=bt.get_cookie(this.config.cookiePrefix+"_"+this.config.page.numberParam);this.config.cookiePrefix&&p&&(this.config.page.number=p),c=this.$reader_page(this.config.page,'<div><span class="Pcurrent">1</span><span class="Pcount">共0条数据</span></div>')}if(c){var u=$(s.config.el+" .tootls_"+l.positon[1]);if(u.length){var f=u.find(".pull-"+l.positon[0]);f.append(c)}else{var b='<div class="tootls_group tootls_'+l.positon[1]+'"><div class="pull-left">'+("left"==l.positon[0]?c:"")+'</div><div class="pull-right">'+("right"==l.positon[0]?c:"")+"</div></div>";"top"===l.positon[1]?($(s.config.el).append(b),0===$(s.config.el+" .divtable").length&&$(s.config.el).append('<div class="divtable mtb10"></div>')):(0===$(s.config.el+" .divtable").length&&$(s.config.el).append('<div class="divtable mtb10"></div>'),$(s.config.el).append(b))}}}this.init||this.$event_bind(i)},$get_data_batch_list:function(e,t){var a=[];return $.each(t||this.data,function(t,s){a.push(s[e])}),a},$reader_page:function(e,t){var a=this,s=$(t),i="",n={};if(s.find("a").addClass("page_link_"+this.random),i+=s.html(),e.numberStatus){var c="page_select_"+this.random;i+='<select class="page_select_number '+c+'">',$.each(e.numberList,function(t,a){i+='<option value="'+a+'" '+(e.number==a?"selected":"")+">"+a+"条/页</option>"}),i+="</select>",n[c]={eventType:"change",type:"page_select"}}if(e.jump){var l="page_jump_input-"+this.random,o="page_jump_btn_"+this.random;i+='<div class="page_jump_group"><span class="page_jump_title">跳转到</span><input type="number" class="page_jump_input '+l+'" value="'+e.page+'" /><span class="page_jump_title">页</span><button type="button" class="page_jump_btn '+o+'">确认</button></div>',n[l]={eventType:"keyup",type:"page_jump_input"},n[o]={type:"page_jump_btn"}}return n["page_link_"+this.random]={type:"cut_page_number"},a.config.page.total=parseInt(s.find(".Pcount").html().match(/([0-9]*)/g)[1]),a.$event_bind(n),'<div class="page">'+i+"</div>"},$dynamic_merge_style:function(e,t){var a="";return $.each(e,function(e,t){switch(e){case"align":a+="text-align:"+t+";";break;case"width":a+="width:"+("string"==typeof t?t:t+"px")+";";break;case"style":a+=t;break;case"minWidth":a+="min-width:"+("string"==typeof t?t:t+"px")+";";break;case"maxWidth":a+="max-width:"+("string"==typeof t?t:t+"px")+";"}}),{index:t,css:a}},$event_bind:function(e){var t=this;$.each(e,function(e,a){if(t.event_list[e]&&t.event_list[e].eventType===a.eventType)return!0;t.event_list[e]=a,$(t.config.el).on(a.eventType||"click","."+e,function(s){var i=$(this).parents("tr").index(),n=$(this).data(),c=[];switch(a.type){case"rows":t.event_rows_model={el:$(this),model:t.config.column[$(this).parents("td").index()],rows:t.data[i],index:i},c=[t.event_rows_model.rows,t.event_rows_model.index,s,e,t];break;case"sort":var l=t.config.column[n.index];$(this).hasClass("sort-active")&&$(".sort_"+t.random+" .sort-active").data({sort:"desc"}),$(".sort_"+t.random).removeClass("sort-active").find(".glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom"),$(this).addClass("sort-active"),"asc"==n.sort?($(this).data({sort:"desc"}),$(this).find(".glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom")):($(this).data({sort:"asc"}),$(this).find(".glyphicon").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")),t.config.sort=t.config.sortParam({name:l.fid,sort:n.sort}),t.$refresh_table_list(!0);break;case"checkbox":var o=$(t.config.el+' [data-checkbox="all"]'),r=$(t.config.el+" tbody .checkbox_"+t.random);null==n.checkbox?$(this).hasClass("active")?($(this).removeClass("active"),t.checkbox_list.splice(t.checkbox_list.indexOf(i),1),t.checkbox_list.length>0?o.addClass("selected").removeClass("active"):o.removeClass("selected active")):($(this).addClass("active"),t.checkbox_list.push(i),t.data.length===t.checkbox_list.length?o.addClass("active").removeClass("selected"):t.checkbox_list.length>0&&o.addClass("selected")):t.checkbox_list.length===t.data.length?(t.checkbox_list=[],r.removeClass("active selected").next().prop("checked","checked"),o.removeClass("active")):(r.each(function(e,a){$(this).hasClass("active")||($(this).addClass("active").next().prop("checked","checked"),t.checkbox_list.push(e))}),o.removeClass("selected").addClass("active")),t.$set_batch_view();break;case"button":c.push(s);break;case"search_input":if(13==s.keyCode)return $(t.config.el+" .search_btn_"+t.random).click(),!1;break;case"search_btn":var d=$(t.config.el+" .search_input"),h=$(t.config.el+" .search_input").val();t.config.search.value=h,d.append('<div class="bt_search_tips"><span>'+h+'</span><i class="bt_search_close"></i></div>'),t.$refresh_table_list(!0);break;case"page_select":var p=parseInt($(this).val());return t.config.page.number=p,t.config.page.page=1,t.$refresh_table_list(!0),!1;case"page_jump_input":return 13==s.keyCode&&($(t.config.el+" .page_jump_btn_"+t.random).click(),$(this).focus()),!1;case"page_jump_btn":var u=parseInt($(t.config.el+" .page_jump_input-"+t.random).val()),f=Math.ceil(t.config.page.total/t.config.page.number);u>f&&(u=t.config.page.page),t.config.page.page=u,t.$refresh_table_list(!0);break;case"cut_page_number":var b=parseInt($(this).attr("href").match(/([0-9]*)$/)[0]);return t.config.page.page=b,t.$refresh_table_list(!0),!1}a.event&&a.event.apply(this,c)})})},$style_bind:function(e,t){var a="",s=this;$.each(e,function(e,t){""!=t.css&&(t.className?a+=t.className+"{"+t.css+"}":a+=s.config.el+" thead th:nth-child("+(t.index+1)+"),"+s.config.el+" tbody tr td:nth-child"+(t.span?" span":"")+"("+(t.index+1)+"){"+t.css+"}")}),0==$("#bt_table_"+s.random).length&&$(s.config.el).append('<style type="text/css" id="bt_table_'+s.random+'">'+a+"</style>")},$get_win_area:function(){return[window.innerWidth,window.innerHeight]},$http:function(e){var t={},a=this.config,s=a.page,i=a.search,n=a.sort||{};s&&(t[s.numberParam]=s.number,t[s.pageParam]=s.page,this.config.cookiePrefix&&bt.set_cookie(this.config.cookiePrefix+"_"+s.numberParam,s.number)),i&&(t[i.searchParam]=i.value),this.config.beforeRequest&&(a.param=this.config.beforeRequest(a.param)),bt_tools.send({url:a.url,data:$.extend(a.param,t,n)},function(t){if(a.dataFilter){var s=a.dataFilter(t);e&&e(s.data,s.page)}else e&&e(t.data,t.page)})}},new t(e)},form:function(e){function t(e){this.config=e,this.$load()}var a=this;return t.prototype={element:null,style_list:[],event_list:{},event_type:["click","event","focus","keyup","blur","change"],hide_list:[],form_element:{},form_config:{},random:bt.get_random(5),$load:function(){var e=this;e.el&&this.$reader_content(function(){e.$event_bind()})},$reader_content:function(e){var t=this,s="",i="",n={};return $.each(t.config.form,function(e,a){s+=t.$reader_content_row(e,a)}),t.element=$('<form class="bt-form" data-form="'+t.random+'">'+s+"</form>"),i=$('<div class="'+a.$verify(t.config.class)+'"><input type="checkbox" class="blur_checked input_checked_'+t.random+'"></div>'),i.append(t.element),n["input_checked_"+t.random]={focus:{type:"input_checked",onEvent:!1,event:function(e,t){return t.checked=!0,!1}},blur:{type:"input_checked",onEvent:!1,event:function(e,t){t.checked=!1,t.checked_blur&&t.checked_blur(e)}}},$.extend(t.event_list,n),e&&e(),i[0].outerHTML},$reader_content_row:function(e,t){var s=this,i=t.help;return'<div class="line'+a.$verify(t.class)+a.$verify(t.hide,"hide",!0)+'"'+a.$verify(t.id,"id")+">"+(t.label?'<span class="tname">'+t.label+"</span>":"")+'<div class="'+(t.label?"info-r":"")+a.$verify(t.line_class)+'"'+a.$verify(s.$reader_style(t.line_style),"style")+">"+s.$reader_form_element(t.group,e)+(i?'<div class="c9 mt5 '+a.$verify(i.class,"class")+'" '+a.$verify(s.$reader_style(i.style),"style")+">"+i.list.join("</br>")+"</div>":"")+"</div></div>"},$reader_form_element:function(e,t){var s=this,i="",n={};return Array.isArray(e)||(e=[e]),$.each(e,function(e,c){var l=s.$reader_style(c.style)+a.$verify(c.width,"width","style"),o=s.$verify_group(c,["name","value","placeholder","disabled","readonly","autofocus","autocomplete","min","max"]),r=s.$create_event_config(c),d="";switch(i+=c.label?'<span class="mr5">'+c.label+"</span>":"",void 0!==c.name&&(n[c.name]=r),c.type){case"text":case"checkbox":case"password":case"radio":case"number":var h="event_"+c.name+"_"+s.random;i+='<input type="'+c.type+'"'+o+" "+(c.icon?'id="'+h+'"':"")+' class="bt-input-'+("select_path"!=c.type?c.type:"text")+" mr10 "+(c.label?"form_middle":"")+a.$verify(c.class,"class")+'"'+a.$verify(l,"style")+" />",c.icon&&(i+='<span class="glyphicon '+c.icon.type+" "+c.name+'_icon cursor" '+a.$verify(s.$reader_style(c.icon.style),"style")+"></span>",n[c.name+"_icon"]={click:{type:"select_path",config:c}});break;case"textarea":if(i+='<textarea class="bt-input-text"'+a.$verify(l,"style")+o+" >"+(c.value||"")+"</textarea>",$.each(["blur","focus","change","input"],function(e,t){if(c.tips){var a=null;switch(t){case"blur":a=function(e,t){""===$(this).val()&&$(this).next().show(),layer.close(t.tips.loadT)};break;case"focus":a=function(e,t){$(this).next().hide(),t.tips.loadT=layer.tips(p,$(this),{tips:[1,"#20a53a"],time:0,area:$(this).width()})}}}n[c.name][t]?n[c.name][t].added=a:n[c.name][t]={type:c.type,cust:!1,event:c[t],added:a}}),c.tips){var p="";p=void 0===c.tips.list?c.tips.text:c.tips.list.join("</br>"),i+='<div class="placeholder c9 '+c.name+'_tips" '+a.$verify(s.$reader_style(c.tips.style),"style")+">"+p+"</div>",n[c.name+"_tips"]={click:{type:"textarea_tips",config:c}}}break;case"select":i+=s.$reader_select(c,l,o,t),s.event_list.custom_select={click:{type:"custom_select",children:".bt_select_value"}},s.event_list.custom_select_item={click:{type:"custom_select_item",children:"li.item"}};break;case"link":d="event_"+bt.get_random(6),i+='<a href="'+(c.href||"javascript:;")+'" class="btlink offsetY7'+a.$verify(c.class,"class")+" "+d+'" '+a.$verify(s.$reader_style(c.style),"style")+">"+c.title+"</a>",s.event_list[d]={click:{type:"link_event",event:c.event}};break;case"help":var u="";$.each(c.list,function(e,t){u+="<li>"+t+"</li>"}),i+='<ul class="help-info-text c7'+a.$verify(c.class)+'"'+a.$verify(s.$reader_style(c.style),"style")+">"+u+"</ul>"}s.form_config[c.name]=c}),$.extend(s.event_list,n),i},$create_event_config:function(e){var t={};return void 0===e.name?{}:($.each(this.event_type,function(a,s){e[s]&&(t["event"===s?"click":s]={type:e.type,event:e[s],cust:["select","checkbox","radio"].indexOf(e.type)>-1,config:e})}),t)},$reader_style:function(e){var t="";return"string"==typeof e?e:void 0===e?"":($.each(e,function(e,a){t+=e+":"+a+";"}),t)},$reader_select:function(e,t,s,i){var n=this,c="",l="",o={};if(!Array.isArray(e.list)){var r=e.list;bt_tools.send({url:r.url,data:r.param||{}},function(t){!1!==t.status?(e.list=e.list.dataFilter?e.list.dataFilter(t):t,n.$replace_render_content(i)):bt.msg(t)})}return $.each(e.list,function(t,s){o=s.value===e.value||s.value===n.config.data[e.name]?s:e.list[0],c+='<li class="item'+a.$verify(s.value===o.value?"active":"")+" "+(s.disabled?"disabled":"")+'">'+s.title+"</li>",l+='<option value="'+s.value+'"'+(s.disabled?"disabled":"")+" "+a.$verify(s.value===o.value?"selectd":"")+">"+s.title+"</option>"}),!o.title&&Array.isArray(e.list)&&(o=e.list[0]),'<div class="bt_select_updown mr10 '+(e.disabled?"bt_disabled":"")+" "+a.$verify(e.hide,"hide",!0)+a.$verify(e.class)+'" '+a.$verify(t,"style")+' data-name="'+e.name+'"><span class="bt_select_value"><span class="bt_select_content">'+(o.title||"获取数据中...")+'</span><span class="glyphicon glyphicon-triangle-bottom ml5"></span></span><ul class="bt_select_list">'+(c||"")+"</ul><select"+s+' class="hide" '+(e.disabled?"disabled":"")+">"+(l||"")+"</select></div>"},$replace_render_content:function(e){var t=this,a=this.config.form[e];$("[data-form="+t.random+"]").find(".line:eq("+e+")").replaceWith(t.$reader_content_row(e,a))},$event_bind:function(e,t){var a=this,s={};a.element=$("object"==typeof e?a.element:"[data-form="+a.random+"]"),void 0===e&&(s=a.event_list),$.each(s,function(e,t){if($.isEmptyObject(t))return!0;$.each(t,function(t,s){var i="";i="boolean"==typeof s.cust?"["+(s.cust?"data-":"")+"name="+e+"]":"."+e,function(e,s){if(!1===e.onEvent){switch(e.type){case"input_checked":$(i).on("event"!=t?t:"click",function(t){e.event.apply(this,[t,a])})}return!0}a.element.on("event"!=t?t:"click",e.children?e.children:i,function(t){var i=a.$get_form_element(),n=a.$get_form_value(),c=a.form_config[s];switch(e.type){case"textarea_tips":$(this).hide().prev().focus();break;case"custom_select":if($(this).parent().hasClass("bt_disabled"))return!1;var l=$(this).next();return l.hasClass("show")?l.removeClass("show"):($(".bt_select_list").removeClass("show"),l.addClass("show")),$(document).click(function(){return a.element.find(".bt_select_list").removeClass("show"),$(this).unbind("click"),!1}),!1;case"custom_select_item":if(c=a.form_config[$(this).parents(".bt_select_updown").attr("data-name")],item_config=c.list[$(this).index()],$(this).hasClass("disabled"))return $(this).parent().removeClass("show"),item_config.tips&&layer.msg(item_config.tips,{icon:2}),!0;$(this).hasClass("active")||$(this).hasClass("disabled")||($(this).parent().prev().find(".bt_select_content").text($(this).text()),$(this).addClass("active").siblings().removeClass("active"),$(this).parent().next().val(item_config.value.toString()),$(this).parent().removeClass("show"),$(this).parent().next().trigger("change"));break;case"select_path":bt.select_path("event_"+$(this).prev().attr("name")+"_"+a.random)}e.event&&e.event.apply(this,[n,i,a,c,t]),e.added&&e.added.apply(this,[t,c])})}(s,e)})}),t&&t()},$get_form_value:function(){return this.element.serializeObject()},$set_find_value:function(e,t){var a={},s=this;"string"!=typeof e?a=e:a[e]=t,$.each(a,function(e,t){s.form_element[e].val(t)})},$get_form_element:function(e){var t={},a=this;if(!e&&!$.isEmptyObject(a.form_element))return a.form_element;this.element.find(":input").each(function(e){t[$(this).attr("name")]=$(this)}),a.form_element=t},$verify_group:function(e,t){var a="";return $.each(t,function(t,s){if(void 0===e[s])return!0;["disabled","readonly"].indexOf(s)>-1?a+=" "+(e[s]?s+'="'+s+'"':""):a+=" "+s+'="'+e[s]+'"'}),a},$verify_bind_event:function(e,t,a){var s={};return $.each(a,function(a,i){var n=t[i];n&&("object"==typeof s[e]?(Array.isArray(s[e])||(s[e]=[s[e]]),s[e].push({event:n,eventType:i})):s[e]={event:n,eventType:i})}),s},$verify:function(e,t,a){return e?!0===a?e?" "+t:"":"style"===a?t?t+":"+e+";":e:t?" "+t+'="'+e+'"':" "+e:""},$submit:function(e,t){}},new t(e)},tab:function(e){function t(e){this.config=e,this.theme=this.config.theme||{},this.$load()}var a=this;return t.prototype={type:1,theme_list:[{content:"tab-body",nav:"tab-nav",body:"tab-con",active:"on"},{content:"bt-w-body",nav:"bt-w-menu",body:"bt-w-con"}],random:bt.get_random(5),$init:function(){var e=this,t=(this.config.active,e.config.list);this.$event_bind(),t[e.active].success&&t[e.active].success(),t[e.active].init=!0},$load:function(){},$reader_content:function(){var e=this,t=e.config.list,s="",i="",n=e.theme,c=e.config;return void 0===e.active&&(e.active=0),$.isEmptyObject(c.theme)||(n=this.theme_list[e.active],$.each(c.theme,function(e,t){n[e]&&(n[e]+=" "+t)}),e.theme=n),c.type&&$.isEmptyObject(c.theme)&&(this.theme=this.theme_list[e.active]),$.each(t,function(t,a){var c=e.active===t,l=n.active||"active";s+='<span class="'+(c?l:"")+'">'+a.title+"</span>",i+='<div class="tab-block '+(c?l:"")+'">'+(c?a.content:"")+"</div>"}),e.element=$('<div id="tab_'+e.random+'" class="'+n.content+a.$verify(e.config.class)+'"><div class="'+n.nav+'" >'+s+'</div><div class="'+n.body+'">'+i+"</div></div>"),e.element[0].outerHTML},$reader_find:function(){},$event_bind:function(){var e=this,t=e.theme,a=t.active||"active";e.el||(e.element=$("#tab_"+e.random)),e.element.on("click","."+t.nav.replace(/\s+/g,".")+" span",function(){var s=$(this).index(),i=e.config.list[s];$(this).addClass(a).siblings().removeClass(a),$("."+t.body+">div:eq("+s+")").addClass(a).siblings().removeClass(a),e.active=s,i.init||($("."+t.body+">div:eq("+s+")").html(i.content),i.success&&i.success(),i.init=!0)})}},new t(e)},open:function(e){var t={},a=null;return t=$.extend({type:1,area:"640px",closeBtn:2,btn:["确认","取消"]},e),a=layer.open(t),{close:function(){layer.close(a)}}},msg:function(e,t){var a=null,s="",i={};return"object"==typeof e&&"boolean"==typeof e.status&&(s=e.msg,i={icon:e.status?1:2}),"string"==typeof e&&(s=e,i={icon:void 0!==t?t:1}),a=layer.msg(s,i),{close:function(){layer.close(a)}}},$verify:function(e,t,a){return e?!0===a?e?" "+t:"":"style"===a?t?t+":"+e+";":e:t?" "+t+'="'+e+'"':" "+e:""},send:function(e,t,a,s,i){var n={},c=null,l=null;"string"==typeof e?n.url=e:"object"==typeof e&&(n=$.extend(n,e)),"object"==typeof t?(n.data=t,c=a,"function"==typeof s&&(l=s)):"function"==typeof t&&(c=t,"function"==typeof a&&(l=a));for(var o=1;o<arguments.length;o++)if("boolean"==typeof arguments[o]){var r=e.split("/");n.url="/"+r[0]+"?action="+r[1];break}""==typeof n.load&&bt.load,$.ajax({type:n.type||"POST",url:n.url,data:n.data||{},dataType:n.dataType||"JSON",complete:function(){n.load&&n.load.close()},success:function(e){return"string"==typeof e?(layer.msg(e,{icon:2,time:0,closeBtn:2}),!1):n.bacth?(c&&c(e),!1):!1===e.status?(bt.msg(e),!1):void(c&&c(e))},error:function(e){l&&l(e)}})}};$.fn.serializeObject=function(){var e=Object.prototype.hasOwnProperty;return this.serializeArray().reduce(function(t,a){return e.call(t,a.name)||(t[a.name]=a.value),t},{})};